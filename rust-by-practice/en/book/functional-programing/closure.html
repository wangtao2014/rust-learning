<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Closure - Rust By Practice</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Learn Rust with Example, Exercise and real Practice, written with ❤️ by https://course.rs team">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/style1.css">


    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');
                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }
                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../why-exercise.html"><strong aria-hidden="true">1.</strong> Rust By Practice</a></li><li class="chapter-item expanded "><a href="../elegant-code-base.html"><strong aria-hidden="true">2.</strong> Small projects with Elegant code</a></li><li class="chapter-item expanded "><a href="../variables.html"><strong aria-hidden="true">3.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../basic-types/intro.html"><strong aria-hidden="true">4.</strong> Basic Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../basic-types/numbers.html"><strong aria-hidden="true">4.1.</strong> Numbers</a></li><li class="chapter-item "><a href="../basic-types/char-bool-unit.html"><strong aria-hidden="true">4.2.</strong> Char, Bool and Unit</a></li><li class="chapter-item "><a href="../basic-types/statements-expressions.html"><strong aria-hidden="true">4.3.</strong> Statements and Expressions</a></li><li class="chapter-item "><a href="../basic-types/functions.html"><strong aria-hidden="true">4.4.</strong> Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../ownership/intro.html"><strong aria-hidden="true">5.</strong> Ownership and Borrowing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ownership/ownership.html"><strong aria-hidden="true">5.1.</strong> Ownership</a></li><li class="chapter-item "><a href="../ownership/borrowing.html"><strong aria-hidden="true">5.2.</strong> Reference and Borrowing</a></li></ol></li><li class="chapter-item expanded "><a href="../compound-types/intro.html"><strong aria-hidden="true">6.</strong> Compound Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../compound-types/string.html"><strong aria-hidden="true">6.1.</strong> string</a></li><li class="chapter-item "><a href="../compound-types/array.html"><strong aria-hidden="true">6.2.</strong> Array</a></li><li class="chapter-item "><a href="../compound-types/slice.html"><strong aria-hidden="true">6.3.</strong> Slice</a></li><li class="chapter-item "><a href="../compound-types/tuple.html"><strong aria-hidden="true">6.4.</strong> Tuple</a></li><li class="chapter-item "><a href="../compound-types/struct.html"><strong aria-hidden="true">6.5.</strong> Struct</a></li><li class="chapter-item "><a href="../compound-types/enum.html"><strong aria-hidden="true">6.6.</strong> Enum</a></li></ol></li><li class="chapter-item expanded "><a href="../flow-control.html"><strong aria-hidden="true">7.</strong> Flow Control</a></li><li class="chapter-item expanded "><a href="../pattern-match/intro.html"><strong aria-hidden="true">8.</strong> Pattern Match</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../pattern-match/match-iflet.html"><strong aria-hidden="true">8.1.</strong> match, matches! and if let</a></li><li class="chapter-item "><a href="../pattern-match/patterns.html"><strong aria-hidden="true">8.2.</strong> Patterns</a></li></ol></li><li class="chapter-item expanded "><a href="../method.html"><strong aria-hidden="true">9.</strong> Method & Associated function</a></li><li class="chapter-item expanded "><a href="../generics-traits/intro.html"><strong aria-hidden="true">10.</strong> Generics and Traits</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../generics-traits/generics.html"><strong aria-hidden="true">10.1.</strong> Generics</a></li><li class="chapter-item "><a href="../generics-traits/const-generics.html"><strong aria-hidden="true">10.2.</strong> Const Generics</a></li><li class="chapter-item "><a href="../generics-traits/traits.html"><strong aria-hidden="true">10.3.</strong> Traits</a></li><li class="chapter-item "><a href="../generics-traits/trait-object.html"><strong aria-hidden="true">10.4.</strong> Trait Object</a></li><li class="chapter-item "><a href="../generics-traits/advanced-traits.html"><strong aria-hidden="true">10.5.</strong> Advanced Traits</a></li></ol></li><li class="chapter-item expanded "><a href="../collections/intro.html"><strong aria-hidden="true">11.</strong> Collection Types</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../collections/string.html"><strong aria-hidden="true">11.1.</strong> String</a></li><li class="chapter-item "><a href="../collections/vector.html"><strong aria-hidden="true">11.2.</strong> Vector</a></li><li class="chapter-item "><a href="../collections/hashmap.html"><strong aria-hidden="true">11.3.</strong> HashMap</a></li></ol></li><li class="chapter-item expanded "><a href="../type-conversions/intro.html"><strong aria-hidden="true">12.</strong> Type Conversion</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../type-conversions/as.html"><strong aria-hidden="true">12.1.</strong> as</a></li><li class="chapter-item "><a href="../type-conversions/from-into.html"><strong aria-hidden="true">12.2.</strong> From/Into</a></li><li class="chapter-item "><a href="../type-conversions/others.html"><strong aria-hidden="true">12.3.</strong> Others</a></li></ol></li><li class="chapter-item expanded "><a href="../result-panic/intro.html"><strong aria-hidden="true">13.</strong> Result and panic</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../result-panic/panic.html"><strong aria-hidden="true">13.1.</strong> panic!</a></li><li class="chapter-item "><a href="../result-panic/result.html"><strong aria-hidden="true">13.2.</strong> Result and ?</a></li></ol></li><li class="chapter-item expanded "><a href="../crate-module/intro.html"><strong aria-hidden="true">14.</strong> Crate and Module</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../crate-module/crate.html"><strong aria-hidden="true">14.1.</strong> Package and Crate</a></li><li class="chapter-item "><a href="../crate-module/module.html"><strong aria-hidden="true">14.2.</strong> Module</a></li><li class="chapter-item "><a href="../crate-module/use-pub.html"><strong aria-hidden="true">14.3.</strong> Advanced use and pub</a></li></ol></li><li class="chapter-item expanded "><a href="../comments-docs.html"><strong aria-hidden="true">15.</strong> Comments and Docs</a></li><li class="chapter-item expanded "><a href="../formatted-output/intro.html"><strong aria-hidden="true">16.</strong> Formatted output</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../formatted-output/println.html"><strong aria-hidden="true">16.1.</strong> println! and format!</a></li><li class="chapter-item "><a href="../formatted-output/debug-display.html"><strong aria-hidden="true">16.2.</strong> Debug and Display</a></li><li class="chapter-item "><a href="../formatted-output/formatting.html"><strong aria-hidden="true">16.3.</strong> formating</a></li></ol></li><li class="chapter-item expanded "><a href="../lifetime/intro.html"><strong aria-hidden="true">17.</strong> Lifetime</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../lifetime/basic.html"><strong aria-hidden="true">17.1.</strong> basic</a></li><li class="chapter-item "><a href="../lifetime/static.html"><strong aria-hidden="true">17.2.</strong> &'static and T: 'static</a></li><li class="chapter-item "><a href="../lifetime/advance.html"><strong aria-hidden="true">17.3.</strong> advanced</a></li></ol></li><li class="chapter-item expanded "><a href="../functional-programing/intro.html"><strong aria-hidden="true">18.</strong> Functional programing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../functional-programing/closure.html" class="active"><strong aria-hidden="true">18.1.</strong> Closure</a></li><li class="chapter-item "><a href="../functional-programing/iterator.html"><strong aria-hidden="true">18.2.</strong> Iterator</a></li></ol></li><li class="chapter-item expanded "><a href="../newtype-sized.html"><strong aria-hidden="true">19.</strong> newtype and DST</a></li><li class="chapter-item expanded "><a href="../smart-pointers/intro.html"><strong aria-hidden="true">20.</strong> Smart pointers TODO</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../smart-pointers/box.html"><strong aria-hidden="true">20.1.</strong> Box</a></li><li class="chapter-item "><a href="../smart-pointers/deref.html"><strong aria-hidden="true">20.2.</strong> Deref</a></li><li class="chapter-item "><a href="../smart-pointers/drop.html"><strong aria-hidden="true">20.3.</strong> Drop</a></li><li class="chapter-item "><a href="../smart-pointers/rc-arc.html"><strong aria-hidden="true">20.4.</strong> Rc and Arc</a></li><li class="chapter-item "><a href="../smart-pointers/cell-refcell.html"><strong aria-hidden="true">20.5.</strong> Cell and RefCell</a></li></ol></li><li class="chapter-item expanded "><a href="../weak.html"><strong aria-hidden="true">21.</strong> Weak and Circle reference TODO</a></li><li class="chapter-item expanded "><a href="../self-referential.html"><strong aria-hidden="true">22.</strong> Self referential TODO</a></li><li class="chapter-item expanded "><a href="../threads/intro.html"><strong aria-hidden="true">23.</strong> Threads TODO</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../threads/basic-using.html"><strong aria-hidden="true">23.1.</strong> Basic using</a></li><li class="chapter-item "><a href="../threads/message-passing.html"><strong aria-hidden="true">23.2.</strong> Message passing</a></li><li class="chapter-item "><a href="../threads/sync.html"><strong aria-hidden="true">23.3.</strong> Sync</a></li><li class="chapter-item "><a href="../threads/atomic.html"><strong aria-hidden="true">23.4.</strong> Atomic</a></li><li class="chapter-item "><a href="../threads/send-sync.html"><strong aria-hidden="true">23.5.</strong> Send and Sync</a></li></ol></li><li class="chapter-item expanded "><a href="../global-variables.html"><strong aria-hidden="true">24.</strong> Global variables TODO</a></li><li class="chapter-item expanded "><a href="../errors.html"><strong aria-hidden="true">25.</strong> Errors TODO</a></li><li class="chapter-item expanded "><a href="../unsafe/intro.html"><strong aria-hidden="true">26.</strong> Unsafe doing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../unsafe/inline-asm.html"><strong aria-hidden="true">26.1.</strong> Inline assembly</a></li></ol></li><li class="chapter-item expanded "><a href="../macro.html"><strong aria-hidden="true">27.</strong> Macro TODO</a></li><li class="chapter-item expanded "><a href="../tests/intro.html"><strong aria-hidden="true">28.</strong> Tests TODO</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../tests/write-tests.html"><strong aria-hidden="true">28.1.</strong> Write Tests</a></li><li class="chapter-item "><a href="../tests/benchmark.html"><strong aria-hidden="true">28.2.</strong> Benchmark</a></li><li class="chapter-item "><a href="../tests/unit-integration.html"><strong aria-hidden="true">28.3.</strong> Unit and Integration</a></li><li class="chapter-item "><a href="../tests/assertions.html"><strong aria-hidden="true">28.4.</strong> Assertions</a></li></ol></li><li class="chapter-item expanded "><a href="../async/intro.html"><strong aria-hidden="true">29.</strong> Async/Await TODO</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../async/async-await.html"><strong aria-hidden="true">29.1.</strong> async and await!</a></li><li class="chapter-item "><a href="../async/future.html"><strong aria-hidden="true">29.2.</strong> Future</a></li><li class="chapter-item "><a href="../async/pin-unpin.html"><strong aria-hidden="true">29.3.</strong> Pin and Unpin</a></li><li class="chapter-item "><a href="../async/stream.html"><strong aria-hidden="true">29.4.</strong> Stream</a></li></ol></li><li class="chapter-item expanded "><a href="../std/intro.html"><strong aria-hidden="true">30.</strong> Standard Library TODO</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../std/String.html"><strong aria-hidden="true">30.1.</strong> String</a></li></ol></li><li class="chapter-item expanded "><a href="../fight-compiler/intro.html"><strong aria-hidden="true">31.</strong> Fighting with Compiler</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../fight-compiler/borrowing.html"><strong aria-hidden="true">31.1.</strong> Borrowing</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust By Practice</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/sunface/rust-by-practice" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/sunface/rust-by-practice/edit/master/en/src/functional-programing/closure.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <!-- Page table of contents -->
                    <div class="sidetoc"><nav class="pagetoc"></nav></div>
                    <main>
                        <h1 id="closure"><a class="header" href="#closure">Closure</a></h1>
<p>Closures can capture the enclosing evironments. For example we can capture the <code>x</code> variable :</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    let x = 1;
    let closure = |val| val + x;
    assert_eq!(closure(2), 3);
}
</code></pre></pre>
<p>From the syntax, we can see that closures are very convenient for on the fly usage. Unlike functions, both the input and return types of a closure can be inferred by the compiler.</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    // Increment via closures and functions.
    fn function(i: i32) -&gt; i32 { i + 1 }

    // Closures are anonymous, here we are binding them to references
    // 
    // These nameless functions are assigned to appropriately named variables.
    let closure_annotated = |i: i32| -&gt; i32 { i + 1 };
    let closure_inferred  = |i     |          i + 1  ;

    let i = 1;
    // Call the function and closures.
    println!(&quot;function: {}&quot;, function(i));
    println!(&quot;closure_annotated: {}&quot;, closure_annotated(i));
    println!(&quot;closure_inferred: {}&quot;, closure_inferred(i));

    // A closure taking no arguments which returns an `i32`.
    // The return type is inferred.
    let one = || 1;
    println!(&quot;closure returning one: {}&quot;, one());

}
</code></pre></pre>
<h2 id="capturing"><a class="header" href="#capturing">Capturing</a></h2>
<p>Closures can capture variables by borrowing or moving. But they prefer to capture by borrowing and only go lower when required:</p>
<ul>
<li>by reference: <code>&amp;T</code></li>
<li>by mutable reference: <code>&amp;mut T</code></li>
<li>by value: <code>T</code></li>
</ul>
<p>1、🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Make it work with least changing */
fn main() {
    let color = String::from(&quot;green&quot;);

    let print = move || println!(&quot;`color`: {}&quot;, color);

    print();
    print();

    // `color` can be borrowed immutably again, because the closure only holds
    // an immutable reference to `color`. 
    let _reborrow = &amp;color;

    println!(&quot;{}&quot;,color);
}
</code></pre></pre>
<p>2、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Make it work 
- Dont use `_reborrow` and `_count_reborrowed`
- Dont modify `assert_eq`
*/
fn main() {
    let mut count = 0;

    let mut inc = || {
        count += 1;
        println!(&quot;`count`: {}&quot;, count);
    };

    inc();


    let _reborrow = &amp;count; 

    inc();

    // The closure no longer needs to borrow `&amp;mut count`. Therefore, it is
    // possible to reborrow without an error
    let _count_reborrowed = &amp;mut count; 

    assert_eq!(count, 0);
}
</code></pre></pre>
<p>3、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Make it work in two ways, none of them is to remove `take(movable)` away from the code
*/
fn main() {
     let movable = Box::new(3);

     let consume = || {
         println!(&quot;`movable`: {:?}&quot;, movable);
         take(movable);
     };

     consume();
     consume();
}

fn take&lt;T&gt;(_v: T) {}
</code></pre></pre>
<p>For comparison, the following code has no error: </p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
     let movable = Box::new(3);

     let consume = move || {
         println!(&quot;`movable`: {:?}&quot;, movable);
     };

     consume();
     consume();
}
</code></pre></pre>
<h2 id="type-inferred"><a class="header" href="#type-inferred">Type inferred</a></h2>
<p>The following four closures has no difference in input and return  types.</p>
<pre><pre class="playground"><code class="language-rust edition2021"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn  add_one_v1   (x: u32) -&gt; u32 { x + 1 }
let add_one_v2 = |x: u32| -&gt; u32 { x + 1 };
let add_one_v3 = |x|             { x + 1 };
let add_one_v4 = |x|               x + 1  ;
<span class="boring">}
</span></code></pre></pre>
<p>4、🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">fn main() {
    let example_closure = |x| x;

    let s = example_closure(String::from(&quot;hello&quot;));

    /* Make it work, only changeg the following line */
    let n = example_closure(5);
}
</code></pre></pre>
<h2 id="fn-fnmut-fnonce"><a class="header" href="#fn-fnmut-fnonce">Fn, FnMut, FnOnce</a></h2>
<p>When taking a closure as an input parameter, the closure's complete type must be annotated using one of the following traits:</p>
<ul>
<li>Fn: the closure uses the captured value by reference (&amp;T)</li>
<li>FnMut: the closure uses the captured value by mutable reference (&amp;mut T)</li>
<li>FnOnce: the closure uses the captured value by value (T)</li>
</ul>
<p>5、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Make it work by change the trait bound, in two ways*/
fn fn_once&lt;F&gt;(func: F)
where
    F: FnOnce(usize) -&gt; bool,
{
    println!(&quot;{}&quot;, func(3));
    println!(&quot;{}&quot;, func(4));
}

fn main() {
    let x = vec![1, 2, 3];
    fn_once(|z|{z == x.len()})
}
</code></pre></pre>
<p>6、 🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">fn main() {
    let mut s = String::new();

    let update_string = |str| s.push_str(str);

    exec(update_string);

    println!(&quot;{:?}&quot;,s);
}

/* Fill in the blank */
fn exec&lt;'a, F: __&gt;(mut f: F)  {
    f(&quot;hello&quot;)
}
</code></pre></pre>
<h4 id="which-trait-does-the-compiler-prefer-to-use"><a class="header" href="#which-trait-does-the-compiler-prefer-to-use">Which trait does the compiler prefer to use?</a></h4>
<ul>
<li>Fn: the closure uses the captured value by reference (&amp;T)</li>
<li>FnMut: the closure uses the captured value by mutable reference (&amp;mut T)</li>
<li>FnOnce: the closure uses the captured value by value (T)</li>
</ul>
<p>On a variable-by-variable basis, the compiler will capture variables in the least restrictive manner possible.</p>
<p>For instance, consider a parameter annotated as FnOnce. This specifies that the closure may capture by <code>&amp;T</code>, <code>&amp;mut T</code>, or <code>T</code>, but the compiler will ultimately choose based on how the captured variables are used in the closure.
Which trait to use is determined by what the closure does with captured value. </p>
<p>This is because if a move is possible, then any type of borrow should also be possible. Note that the reverse is not true. If the parameter is annotated as <code>Fn</code>, then capturing variables by <code>&amp;mut T</code> or <code>T</code> are not allowed.</p>
<p>7、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Fill in the blank */

// A function which takes a closure as an argument and calls it.
// &lt;F&gt; denotes that F is a &quot;Generic type parameter&quot;
fn apply&lt;F&gt;(f: F) where
    // The closure takes no input and returns nothing.
    F: __ {

    f();
}

// A function which takes a closure and returns an `i32`.
fn apply_to_3&lt;F&gt;(f: F) -&gt; i32 where
    // The closure takes an `i32` and returns an `i32`.
    F: Fn(i32) -&gt; i32 {

    f(3)
}

fn main() {
    use std::mem;

    let greeting = &quot;hello&quot;;
    // A non-copy type.
    // `to_owned` creates owned data from borrowed one
    let mut farewell = &quot;goodbye&quot;.to_owned();

    // Capture 2 variables: `greeting` by reference and
    // `farewell` by value.
    let diary = || {
        // `greeting` is by reference: requires `Fn`.
        println!(&quot;I said {}.&quot;, greeting);

        // Mutation forces `farewell` to be captured by
        // mutable reference. Now requires `FnMut`.
        farewell.push_str(&quot;!!!&quot;);
        println!(&quot;Then I screamed {}.&quot;, farewell);
        println!(&quot;Now I can sleep. zzzzz&quot;);

        // Manually calling drop forces `farewell` to
        // be captured by value. Now requires `FnOnce`.
        mem::drop(farewell);
    };

    // Call the function which applies the closure.
    apply(diary);

    // `double` satisfies `apply_to_3`'s trait bound
    let double = |x| 2 * x;

    println!(&quot;3 doubled: {}&quot;, apply_to_3(double));
}
</code></pre></pre>
<p>move closures may still implement <code>Fn</code> or <code>FnMut</code>, even though they capture variables by move. This is because the traits implemented by a closure type are determined by what the closure does with captured values, not how it captures them. The <code>move</code> keyword only specifies the latter.</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    let s = String::new();

    let update_string = move || println!(&quot;{}&quot;,s);

    exec(update_string);
}

fn exec&lt;F: FnOnce()&gt;(f: F)  {
    f()
}
</code></pre></pre>
<p>The following code also has no error:</p>
<pre><pre class="playground"><code class="language-rust edition2021">fn main() {
    let s = String::new();

    let update_string = move || println!(&quot;{}&quot;,s);

    exec(update_string);
}

fn exec&lt;F: Fn()&gt;(f: F)  {
    f()
}
</code></pre></pre>
<p>8、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Fill in the blank */
fn main() {
    let mut s = String::new();

    let update_string = |str| -&gt; String {s.push_str(str); s };

    exec(update_string);
}

fn exec&lt;'a, F: __&gt;(mut f: F) {
    f(&quot;hello&quot;);
}
</code></pre></pre>
<h2 id="input-functions"><a class="header" href="#input-functions">Input functions</a></h2>
<p>Since closure maybe used as arguments, you might wonder can we use functions as arguments too? And indeed they can.</p>
<p>9、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">
/* Implement `call_me` to make it work */
fn call_me {
    f();
}

fn function() {
    println!(&quot;I'm a function!&quot;);
}

fn main() {
    let closure = || println!(&quot;I'm a closure!&quot;);

    call_me(closure);
    call_me(function);
}
</code></pre></pre>
<h2 id="closure-as-return-types"><a class="header" href="#closure-as-return-types">Closure as return types</a></h2>
<p>Returning a closure is much harder than you may thought of.</p>
<p>10、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Fill in the blank using two approches,
 and fix the errror */
fn create_fn() -&gt; __ {
    let num = 5;

    // how does the following closure capture the evironment variable `num`
    // &amp;T, &amp;mut T, T ?
    |x| x + num
}


fn main() {
    let fn_plain = create_fn();
    fn_plain(1);
}
</code></pre></pre>
<p>11、🌟🌟</p>
<pre><pre class="playground"><code class="language-rust editable edition2021">/* Fill in the blank and fix the error*/
fn factory(x:i32) -&gt; __ {

    let num = 5;

    if x &gt; 1{
        move |x| x + num
    } else {
        move |x| x + num
    }
}
</code></pre></pre>
<h2 id="closure-in-structs"><a class="header" href="#closure-in-structs">Closure in structs</a></h2>
<p><strong>Example</strong></p>
<pre><pre class="playground"><code class="language-rust edition2021">struct Cacher&lt;T,E&gt;
where
    T: Fn(E) -&gt; E,
    E: Copy
{
    query: T,
    value: Option&lt;E&gt;,
}

impl&lt;T,E&gt; Cacher&lt;T,E&gt;
where
    T: Fn(E) -&gt; E,
    E: Copy
{
    fn new(query: T) -&gt; Cacher&lt;T,E&gt; {
        Cacher {
            query,
            value: None,
        }
    }

    fn value(&amp;mut self, arg: E) -&gt; E {
        match self.value {
            Some(v) =&gt; v,
            None =&gt; {
                let v = (self.query)(arg);
                self.value = Some(v);
                v
            }
        }
    }
}
fn main() {
  
}

#[test]
fn call_with_different_values() {
    let mut c = Cacher::new(|a| a);

    let v1 = c.value(1);
    let v2 = c.value(2);

    assert_eq!(v2, 1);
}
</code></pre></pre>

                        <div id="giscus-container"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../functional-programing/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../functional-programing/iterator.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../functional-programing/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../functional-programing/iterator.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>

        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8">
        var pagePath = "functional-programing/closure.md"
        </script>


        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../assets/custom3.js"></script>
        <script type="text/javascript" src="../assets/lang.js"></script>


    </body>
</html>